<!DOCTYPE html>
<html lang="en">
<head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://github.com/ethereum/web3.js/blob/develop/dist/web3.min.js"></script>


    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">-->
    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>-->
    <script type="text/javascript">
        var ABI = [
            {
                "constant": true,
                "inputs": [],
                "name": "supplierName",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "sellingPrice",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "totalSupply",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "supplierAddress",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "decimals",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint8"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "recvEther",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "sender",
                "outputs": [
                    {
                        "name": "",
                        "type": "address"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [
                    {
                        "name": "",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "productName",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "symbol",
                "outputs": [
                    {
                        "name": "",
                        "type": "string"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    {
                        "name": "_to",
                        "type": "address"
                    },
                    {
                        "name": "_value",
                        "type": "uint256"
                    }
                ],
                "name": "transfer",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "reciever",
                "outputs": [
                    {
                        "name": "",
                        "type": "address"
                    }
                ],
                "payable": false,
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "name": "_supply",
                        "type": "uint256"
                    },
                    {
                        "name": "_productName",
                        "type": "string"
                    },
                    {
                        "name": "_symbol",
                        "type": "string"
                    },
                    {
                        "name": "_decimals",
                        "type": "uint8"
                    },
                    {
                        "name": "_supplierName",
                        "type": "string"
                    },
                    {
                        "name": "_supplierAddress",
                        "type": "string"
                    },
                    {
                        "name": "_totalSupply",
                        "type": "uint256"
                    }
                ],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "constructor"
            },
            {
                "payable": true,
                "stateMutability": "payable",
                "type": "fallback"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Transfer",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": false,
                        "name": "addr",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "name": "escrowValue",
                        "type": "uint256"
                    }
                ],
                "name": "ConfirmedPayment",
                "type": "event"
            }
        ];
        var address = "0xbcc97182bf318488ed4e6b4b1bb1152528e6f4d8";
        var account;
        var contract;
        var balance = 0;


        $(document).ready(function () {
            web3 = new Web3(web3.currentProvider);

            // accounts = ["0x88CD6919E911911B4cB302AB0404c0b10519B625",
            //     "0x0180cE41910b082B3993629c082F17f57b09e2E7"];

            account = web3.eth.accounts;
            contract = web3.eth.contract(ABI).at(address);


            getAllEvents(contract);

            contract.balanceOf(account[0],function(err,res){
                balance = res;
            });
        });

        function getAllEvents(contract) {
            var area_log = document.getElementById('area_log');
            area_log.innerHTML = '<ul class="list-group list-inline">';
            contract.allEvents({fromBlock: 0, toBlock: 'latest'}).get(function (err, res) {
                for (idx in res) {
                    var row = '<li class="list-group-item">';
                    row += res[idx].args.from + '이' + res[idx].args.to + '에게' +
                        res[idx].args.value + 'Gold 송금';
                    // alert(row);
                    area_log.innerHTML += row + '</li>';
                }
            })
            area_log.innerHTML += '</ul>';
        }

        function login(){
            var area_user = document.getElementById('area_login');

            // contract
            area_user.innerHTML = '<h1 class="text-center" id="user1">로그인되었습니다.</h1>';
            area_user.innerHTML += '<span class="label label-default">Address:   ' + account[0] + '</span><p/>';
            area_user.innerHTML += '<label class="">보유 현황 :  '  + balance + '  G' +
                '<P/>\n' +
                '<span class="">송 금</span><input id="product_id" placeholder="전송할 수" class="form-control"\n' +
                'type="number">\n' +
                '<p/>\n' +
                '<button onclick="sendGold()" type="submit" class="btn-block btn btn-primary">전송</button>';

        }

        function sendGold() {
            var count = document.getElementById('product_id').value;
            var to = "0x0180cE41910b082B3993629c082F17f57b09e2E7";
            contract.transfer( to, count, function (err, res) {
                // res[msg.sender]  -= count;
                // res[_to] += count;
            })

        }

    </script>
</head>
<style>
    .container {
        margin: 0;
        max-width: 100%;
    }

    ul.list-group.list-group-striped li:nth-of-type(odd) {
        background: #dddddd;
    }

    ul.list-group.list-group-striped li:nth-of-type(even) {
        background: #aaaaaa;

    }

    h2 {
        text-align: center;

    }


</style>
<body>

<div class="container">
    <h1 class="text-center">Gold Bank</h1>
    <div class="row">
        <div class="col col-lg-6 col-md-6 col-sm-12">
            <div id="area_login" class="">
                <h1 class="text-center" id="user1">로그인하세요</h1>
                <button id="login" class="button button-info" onclick="login()">Log In</button>
            </div>
            <!--</div>-->
            <!--</div>-->
            <!--<div class="col col-lg-6 col-md-6 col-sm-12">-->
            <!--<h1 class="text-center" id="user2">거래</h1>-->


        </div>

        <p/>

        <!--<div class="col col-lg-6 col-md-6 col-sm-12">-->
        <h1 class="text-center" id="user3">거래 현황</h1>
        <div class="col col-lg-6 col-md-6 col-sm-12" id="area_log"></div>
        <!--</div>-->


        <!--<div class="col col-lg-6 col-md-6 col-sm-12">-->
        <!--<h1 class="text-center" id="user4">내가 구입한 상품</h1>-->

        <!--<h2>구매한 품목</h2>-->
        <!--<div id="list_buy">-->
        <!--</div>-->
        <!--</div>-->

    </div>
</div>
</body>
</html>